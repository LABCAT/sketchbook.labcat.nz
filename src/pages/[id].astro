---
import SketchLayout from '@layouts/SketchLayout.astro';
import { sketchMetadata } from '@/sketchMetadata.js';

export async function getStaticPaths() {
  return Object.keys(sketchMetadata).map(id => ({
    params: { id },
    props: { sketchInfo: sketchMetadata[id] },
  }));
}

const { id } = Astro.params;
const { sketchInfo } = Astro.props;
---

<SketchLayout title={sketchInfo.title} description={sketchInfo.description} />

<script>
  // Direct mapping from sketch ID to import function
  const sketches = {
    'complementary-colours': () =>
      import('/src/sketches/colour-theory/sketch-1.js'),
    'blend-mode': () => import('/src/sketches/colour-theory/sketch-2.js'),
    'monochromatic': () => import('/src/sketches/colour-theory/sketch-3.js'),
  };

  // Get the sketch ID from the page URL
  const pathSegments = window.location.pathname.split('/');
  const sketchId =
    pathSegments[pathSegments.length - 1] ||
    pathSegments[pathSegments.length - 2];

  sketches[sketchId]?.()
    .then(module => {
      console.log('Sketch loaded successfully!', module);
    })
    .catch(err => {
      console.error('Failed to load sketch:', err);
    });
</script>
